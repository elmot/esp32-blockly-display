var led16Svg = URL.createObjectURL(new Blob(['<?xml version="1.0" encoding="utf-8"?>\n' +
'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 329 444" enable-background="new 0 0 329 444"\n' +
'     xml:space="preserve">\n' +
'<g id="Layer_1">\n' +
'<g id="_x31_"><polygon fill="#E0E0E0" points="0.6,416.8 33.5,245.3 53,227.7 65.5,243.1 34.6,404.7 10.1,426.3"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="42.6,198.9 72.5,28.2 84,15.7 102.5,36.2 73.6,198.7 55.1,215.3"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="109.3,30.5 91.8,12 104.2,0.5 184.8,0.5 198.3,15 179.9,30.5"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="224.2,31.5 208.8,16.1 229.2,0.5 306.8,0.5 315.3,9 288.9,31.5"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="264.6,200.9 296.5,38.3 319,16.7 328.5,28.1 295.6,197.7 277.1,215.3"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="227.6,407.8 255.5,245.2 273.1,226.7 287.5,240.2 257.6,414.7 244.1,426.3"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="146.3,442.5 133.8,427.1 152.2,413.5 218.8,413.5 237.3,432 225.8,442.5"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="22.7,443 15.3,435.5 38.7,414 108.8,413.5 120.3,426 102.8,443.5"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="50.5,352.2 128.4,243.4 159.9,225.2 124.6,299.8 71.7,373.7 43.7,398.7"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="72.8,237 60.2,221.6 76.7,207 140.4,207 157.7,220.4 129.4,237"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="140.5,200.7 99.6,88 107.4,42.1 125.6,63.3 154.5,152.1 161.4,217.8"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="160.5,150 182.5,39.3 202,21.7 216.5,36.2 193.6,152.8 165.4,209.2"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="207.5,138.2 257.4,69.3 287.3,43.3 279.6,88.8 201.7,197.6 169.2,215.8"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="190.7,237 172.4,221.6 197.7,207 257.3,207 268.8,219.5 249.3,237"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="204.5,377.8 174.5,291.9 168.6,226.2 186.6,241.3 229.5,357.1 223.7,401.8"/></g>\n' +
'    <g><polygon fill="#E0E0E0" points="115.6,405.9 134.5,293.1 162.7,231.9 167.5,285 147.6,403.7 128.1,420.3"/></g>\n' +
'    <g><circle fill="#E0E0E0" cx="296.5" cy="426.5" r="16.5"/></g>\n' +
'</g>\n' +
'    <g id="Layer_2">\n' +
'        <text transform="matrix(1 0 0 1 25.5767 338.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">A</text>\n' +
'        <text transform="matrix(1 0 0 1 63.5767 126.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">B</text>\n' +
'        <text transform="matrix(1 0 0 1 135.5767 24.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">C</text>\n' +
'        <text transform="matrix(1 0 0 1 257.5767 24.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">D</text>\n' +
'        <text transform="matrix(1 0 0 1 288.5767 126.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">E</text>\n' +
'        <text transform="matrix(1 0 0 1 249.5767 338.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">F</text>\n' +
'        <text transform="matrix(1 0 0 1 57.5767 436.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">H</text>\n' +
'        <text transform="matrix(1 0 0 1 179.5767 436.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">G</text>\n' +
'        <text transform="matrix(1 0 0 1 99.5767 303.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">I</text>\n' +
'        <text transform="matrix(1 0 0 1 120.377 151.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">K</text>\n' +
'        <text transform="matrix(1 0 0 1 208.377 151.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">M</text>\n' +
'        <text transform="matrix(1 0 0 1 177.377 303.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">O</text>\n' +
'        <text transform="matrix(1 0 0 1 170.377 117.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">L</text>\n' +
'        <text transform="matrix(1 0 0 1 131.377 335.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">P</text>\n' +
'        <text transform="matrix(1 0 0 1 281.377 435.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">Q</text>\n' +
'        <text transform="matrix(1 0 0 1 96.5767 230.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">J</text>\n' +
'        <text transform="matrix(1 0 0 1 211.377 230.2002)" font-family="\'FiraCode-Bold\'" font-size="24px">N</text>\n' +
'</g>\n' +
'</svg>\n'], {type : 'image/svg+xml'}));
Blockly.Blocks["led_16_segments"] = {
    init: function () {
        this.setColour(160);
        this.appendDummyInput().appendField(new Blockly.FieldImage(led16Svg, 80, 120));
        this.appendDummyInput().appendField("Position").appendField(new Blockly.FieldDropdown([["0", "0"], ["1", "1"], ["2", "2"], ["3", "3"]]), "POS")
        this.appendValueInput("SEGS").appendField("Segments")
        this.setNextStatement(true)
        this.setPreviousStatement(true)
    }
}

javascript.javascriptGenerator.forBlock["led_16_segments"] = function (block, generator) {
    const pos = block.getFieldValue("POS");
    let segsCode = generator.valueToCode(block, "SEGS", javascript.Order.ATOMIC);
    if (segsCode === "") segsCode = "''"
    return `segm16Output(${pos},${segsCode})\n`
}

Blockly.Blocks["sleep"] = {
    init: function () {
        this.setColour(160);
        this.appendDummyInput().appendField("\u231B")
        this.appendValueInput("SECONDS").appendField("Seconds")
        this.setNextStatement(true)
        this.setPreviousStatement(true)
    }
}

javascript.javascriptGenerator.forBlock["sleep"] = function (block, generator) {
    let time = generator.valueToCode(block, "SECONDS", javascript.Order.ATOMIC);
    if (time === "") time = 0
    return `segm16Delay(${time})\n`
}

Blockly.Blocks["led_16_segments_text"] = {
    init: function () {
        this.setColour(160);
        this.appendDummyInput()
            .appendField(new Blockly.FieldImage(led16Svg, 20, 30))
            .appendField(new Blockly.FieldImage(led16Svg, 20, 30))
            .appendField(new Blockly.FieldImage(led16Svg, 20, 30))
            .appendField(new Blockly.FieldImage(led16Svg, 20, 30))
        this.appendValueInput("TEXT").appendField("Text")
        this.setNextStatement(true)
        this.setPreviousStatement(true)
    }
}

javascript.javascriptGenerator.forBlock["led_16_segments_text"] = function (block, generator) {
    let text = generator.valueToCode(block, "TEXT", javascript.Order.ATOMIC);
    if (text === "") text = "''"
    return `segm16Text(${text})\n`
}

const toolbox = {
    kind: "categoryToolbox",
    contents: [
        {
            kind: "category",
            name: "Logic",
            categorystyle: "logic_category",
            contents: [
                {
                    kind: "block",
                    type: "controls_if",
                },
                {
                    kind: "block",
                    type: "logic_compare",
                },
                {
                    kind: "block",
                    type: "logic_operation",
                },
                {
                    kind: "block",
                    type: "logic_negate",
                },
                {
                    kind: "block",
                    type: "logic_boolean",
                },
            ],
        },
        {
            kind: "category",
            name: "Loops",
            categorystyle: "loop_category",
            contents: [
                {
                    kind: "block",
                    type: "controls_repeat_ext",
                    inputs: {
                        TIMES: {
                            shadow: {
                                type: "math_number",
                                fields: {
                                    NUM: 10,
                                },
                            },
                        },
                    },
                },
                {
                    kind: "block",
                    type: "controls_flow_statements",
                },
            ],
        },
        {
            kind: "category",
            name: "Math",
            categorystyle: "math_category",
            contents: [
                {
                    kind: "block",
                    type: "math_number",
                    fields: {
                        NUM: 123,
                    },
                },
                {
                    kind: "block",
                    type: "math_arithmetic",
                    inputs: {
                        A: {
                            shadow: {
                                type: "math_number",
                                fields: {
                                    NUM: 1,
                                },
                            },
                        },
                        B: {
                            shadow: {
                                type: "math_number",
                                fields: {
                                    NUM: 1,
                                },
                            },
                        },
                    },
                },
                {
                    kind: "block",
                    type: "math_single",
                    inputs: {
                        NUM: {
                            shadow: {
                                type: "math_number",
                                fields: {
                                    NUM: 9,
                                },
                            },
                        },
                    },
                },
                {
                    kind: "block",
                    type: "math_number_property",
                    inputs: {
                        NUMBER_TO_CHECK: {
                            shadow: {
                                type: "math_number",
                                fields: {
                                    NUM: 0,
                                },
                            },
                        },
                    },
                },
            ],
        },
        {
            kind: "category",
            name: "Text",
            categorystyle: "text_category",
            contents: [
                {
                    kind: "block",
                    type: "text",
                },
                {
                    kind: "block",
                    type: "text_join",
                },

                {
                    kind: "block",
                    type: "text_append",
                },
                {
                    kind: "block",
                    type: "text_isEmpty",
                },
                {
                    kind: "block",
                    type: "text_indexOf",
                },
                {
                    kind: "block",
                    type: "text_charAt",
                },
                {
                    kind: "block",
                    type: "text_getSubstring",
                },
                {
                    kind: "block",
                    type: "text_changeCase",
                },
                {
                    kind: "block",
                    type: "text_trim",
                },
                {
                    kind: "block",
                    type: "text_print",
                },
                {
                    kind: "block",
                    type: "text_prompt_ext",
                },
                {
                    kind: "block",
                    type: "text_count",
                },
                {
                    kind: "block",
                    type: "text_replace",
                },
                {
                    kind: "block",
                    type: "text_reverse",
                }

            ],
        },
        {
            kind: "category",
            name: "Variables",
            categorystyle: "variable_category",
            custom: "VARIABLE",
        },
        {
            kind: "category",
            name: "Control",
            colour: 350,
            contents: [
                {
                    kind: "block",
                    type: "led_16_segments",
                },
                {
                    kind: "block",
                    type: "sleep",
                },
                {
                    kind: "block",
                    type: "led_16_segments_text",
                }
            ]
        },
    ],
};
