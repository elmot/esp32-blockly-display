<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>16-Segment Control</title>
    <!-- Load Blockly core -->
    <script src="./blockly/blockly_compressed.js"></script>
    <!-- Load the default blocks -->
    <script src="./blockly/blocks_compressed.js"></script>
    <!-- Load a generators -->
    <script src="./blockly/javascript_compressed.js"></script>
    <!-- Load a message file -->
    <script src="./blockly/msg/en.js"></script>

    <script src="led16_segment_blocks.js"></script>
    <script src="led_control.js"></script>
    <style>
        #displayDiv {
            padding: 2cqh;
            position: absolute;
            right: 5cqw;
            top: 5cqh;
            background-color: #f8f8f8;
            border: darkslategrey 3px dashed;
            border-radius: 1cqw;
        }

        #displayDiv embed {
            height: 12cqh;
            width: 7cqw
        }
    </style>
</head>
<body>
<div id="blocklyDiv" style="height: 95cqh; width: 95cqw;"></div>
<!-- todo make normal <button id="save">Save</button>-->
<div id="displayDiv">
    <embed type="image/svg+xml" id="digit0">
    <embed type="image/svg+xml" id="digit1">
    <embed type="image/svg+xml" id="digit2">
    <embed type="image/svg+xml" id="digit3">
</div>
</body>
<script>
    const config = {
        grid:
            {
                spacing: 20,
                length: 3,
                colour: "#ccc",
                snap: true
            },
        oneBasedIndex: false,
        sounds: false,
        toolbox: toolbox,
        zoom: {controls: true}

    };
    const workspace = Blockly.inject("blocklyDiv", config);
    workspace.addChangeListener(function (event) {
            if (event.type === Blockly.Events.BLOCK_CHANGE)
                eval(javascript.javascriptGenerator.workspaceToCode(workspace))
        }
    )
    //todo display stuff led
    //todo save/restore
    document.getElementById("digit0").src = led16Svg
    document.getElementById("digit1").src = led16Svg
    document.getElementById("digit2").src = led16Svg
    document.getElementById("digit3").src = led16Svg
    // document.getElementById("save").addEventListener("click", function () {
    //     console.log(JSON.stringify(Blockly.serialization.workspaces.save(workspace)))
    // }) //todo make normalRussia
    //todo remove
    // Blockly.serialization.workspaces.load(
    //     JSON.parse('{"blocks":{"languageVersion":0,"blocks":[{"type":"led_16_segments_text","id":"D46A5oqnM*c*yQ5uX;=.","x":310,"y":390,"inputs":{"TEXT":{"block":{"type":"text","id":"C,/Nu1mmbk@ja8l(V4:q","fields":{"TEXT":' +
    //         '"БЮ"}}}}}]}}')
    //     , workspace)
    //Todo remove
    // setTimeout(function () {
    //
    //     eval(javascript.javascriptGenerator.workspaceToCode(workspace))
    // }, 100)

</script>

</html>